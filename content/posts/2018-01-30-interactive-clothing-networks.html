---
title: Interactive clothing networks
author: Allen Chang
date: '2018-01-30'
slug: interactive-clothing-networks
categories: []
tags:
  - networks
  - visualization
  - R
  - clothing
draft: yes
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<script src="/rmarkdown-libs/threejs/three.min.js"></script>
<script src="/rmarkdown-libs/threejs/Detector.js"></script>
<script src="/rmarkdown-libs/threejs/Projector.js"></script>
<script src="/rmarkdown-libs/threejs/CanvasRenderer.js"></script>
<script src="/rmarkdown-libs/threejs/TrackballControls.js"></script>
<script src="/rmarkdown-libs/threejs/StateOrbitControls.js"></script>
<script src="/rmarkdown-libs/scatterplotThree-binding/scatterplotThree.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>


<p>This is part 3 of my exploration of preferences in clothing choices (<a href="">part 1</a>, <a href="">part 2</a>) In this post Iâ€™m going to be testing out the the <strong>threejs</strong> package and creating interactive networks using the <em>graphjs</em> function. I also</p>
<pre class="r"><code>library(tidyverse)
library(igraph)
library(threejs)
library(lubridate)
library(stringr)
library(reshape2)
library(htmlwidgets)
library(gganimate)</code></pre>
<section id="data-pre-processing" class="level3">
<h3>Data pre-processing</h3>
<pre class="r"><code>summer &lt;- read_csv(&quot;/Users/allenchang/Desktop/functionally_defined/data/summer.csv&quot;)
fw &lt;- read_csv(&quot;/Users/allenchang/Desktop/functionally_defined/data/fallwinter.csv&quot;)

fw &lt;- fw %&gt;%
  select(1:3)

clothes_df &lt;- rbind(summer, fw)
clothes_df$Day &lt;- mdy(clothes_df$Day)</code></pre>
<pre class="r"><code>clothes_df &lt;- clothes_df %&gt;%
  mutate(maker_up = toupper(Maker)) %&gt;%
  select(Day, maker_up) %&gt;%
  filter(!maker_up == &quot;NA&quot;)

clothes_mat &lt;- clothes_df %&gt;%
  acast(maker_up ~ Day, fun.aggregate = length)

cooccur &lt;- clothes_mat %*% t(clothes_mat)</code></pre>
</section>
<section id="animated-timeline" class="level3">
<h3>Animated timeline</h3>
<pre class="r"><code>h &lt;- hclust(dist(clothes_mat, method = &quot;canberra&quot;))

ordering &lt;- h$labels[h$order]

day_vis &lt;- clothes_df %&gt;%
  ungroup() %&gt;%
  mutate(maker = factor(maker_up, levels = ordering)) 

p &lt;- ggplot(day_vis, aes(Day, maker)) +
  geom_path(aes(group = Day, frame = Day, cumulative = TRUE)) +
  geom_point(aes(frame = Day, cumulative = TRUE), color = &quot;red&quot;, size = 1) +
  geom_vline(aes(xintercept = as.numeric(Day), frame = as.numeric(Day)), lty = 2, color = &quot;black&quot;) +
  theme(axis.text.y = element_text(face=&quot;bold&quot;)) + 
  ylab(&quot;Maker&quot;) + xlab(&quot;Time&quot;) +
  ggtitle(&quot;7 months of clothing choices:&quot;) +
  scale_x_date(date_breaks = &quot;1 month&quot;, date_labels = &quot;%b&quot;) +
  theme_bw()

gganimate(p, &quot;test.gif&quot;, ani.width = 1000, ani.height = 500, interval = 0.3)</code></pre>
<p><img src="/Users/allenchang/Desktop/timeline.gif" /></p>
</section>
<section id="networks-in-igraph" class="level3">
<h3>Networks in igraph</h3>
<pre class="r"><code>g &lt;- graph.adjacency(cooccur, weighted = TRUE, mode = &quot;undirected&quot;, diag = FALSE)

V(g)$vertex_degree &lt;-  degree(g)

counts &lt;- as.data.frame(lengths(as_adj_list(g))) %&gt;%
  rownames_to_column()

names(counts) &lt;- c(&quot;maker&quot;, &quot;count&quot;)
counts &lt;- counts %&gt;%
  filter(count &lt; 10)

g2 &lt;- delete_vertices(g, counts$maker)</code></pre>
<pre class="r"><code># country &lt;- c(&quot;USA&quot;, &quot;Japan&quot;, &quot;USA&quot;, &quot;South Korea&quot;, &quot;Belgium&quot;,
#              &quot;Italy&quot;, &quot;Austria&quot;, &quot;France&quot;, &quot;Japan&quot;, &quot;France&quot;,
#              &quot;France&quot; , &quot;USA&quot;, &quot;Japan&quot;, &quot;Belgium&quot;, &quot;Japan&quot;,
#              &quot;Japan&quot;, &quot;USA&quot;)

 scheme &lt;- c(&quot;#A60C00&quot;, &quot;#1533AD&quot;, &quot;#A60C00&quot;, &quot;#7109AA&quot;, &quot;#A63C00&quot;,
             &quot;#007B25&quot;, &quot;#009999&quot;, &quot;#CB0077&quot;, &quot;#1533AD&quot;, &quot;#CB0077&quot;,
             &quot;#CB0077&quot;, &quot;#A60C00&quot;, &quot;#1533AD&quot;, &quot;#A63C00&quot;, &quot;#1533AD&quot;,
             &quot;#1533AD&quot;, &quot;#A60C00&quot;)</code></pre>
</section>
<section id="interactive-networks-using-graphjs" class="level3">
<h3>Interactive networks using graphjs</h3>
<pre class="r"><code>graphjs(g2, 
        layout = list(
          layout_randomly(g2, dim = 3),
          layout_on_sphere(g2),
          layout_with_fr(g2, dim = 3, niter = 30),
          layout_with_drl(g2, dim = 3),
          layout_with_fr(g2, dim = 3, niter = 30)
        ),
        repulsion = 6, 
        vertex.shape = &quot;sphere&quot;,
        vertex.size = V(g2)$vertex_degree*.5,
        vertex.label= V(g2)$name,
        stroke = TRUE,
        curvature = 0.2,
        vertex.color = scheme,
        main = c(&quot;random layout&quot;,
                 &quot;sphere layout&quot;,
                 &quot;fr layout&quot;,
                 &quot;dr1 layout&quot;,
                 &quot;fr layout&quot;),
        fpl = 300)</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="scatterplotThree html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"NROW":17,"height":null,"width":null,"axis":false,"numticks":[6,6,6],"xticklabs":null,"yticklabs":null,"zticklabs":null,"color":[["#A60C00","#1533AD","#A60C00","#7109AA","#A63C00","#007B25","#009999","#CB0077","#1533AD","#CB0077","#CB0077","#A60C00","#1533AD","#A63C00","#1533AD","#1533AD","#A60C00"]],"size":[6.5,7,7,9,8,6.5,10.5,8.5,9.5,5,6,6.5,8,5,6.5,10.5,9],"stroke":true,"flipy":true,"grid":false,"renderer":"auto","signif":8,"bg":"white","cexsymbols":1,"xlim":[-1,1],"ylim":[-1,1],"zlim":[-1,1],"pch":["o","o","o","o","o","o","o","o","o","o","o","o","o","o","o","o","o"],"from":[[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,8,8,9,9,10,10,10,10,11,11,11,11,12,12,12,13,13,14,14,15]],"to":[[1,2,4,6,7,8,13,15,16,2,3,4,5,7,10,11,12,13,15,16,3,4,5,6,8,9,10,12,13,14,15,4,5,6,7,8,9,10,11,12,14,15,16,5,6,7,8,9,10,11,12,14,15,16,6,7,8,10,11,12,14,15,7,8,9,10,11,12,13,14,15,16,8,9,12,13,14,15,9,10,11,12,13,14,15,16,12,14,12,14,15,16,12,13,15,16,14,15,16,15,16,15,16,16]],"lwd":1,"linealpha":1,"center":true,"main":["random layout","sphere layout","fr layout","dr1 layout","fr layout"],"repulsion":6,"curvature":0.2,"fpl":300,"labels":["BARNEYS","COMME DES GARCONS HOMME","CONVERSE","DOCUMENT","DRIES VAN NOTEN","GRP","HELMUT LANG","HESCHUNG","ISSEY MIYAKE","LANVIN","MAISON MARTIN MARGIELA","NIKE","SAGE DE CRET","STEPHAN SCHNEIDER","UNDERCOVER","UNIQLO","VANS"],"options":true,"alpha":[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],"vertices":[[-0.068982684,-0.6905732,0.36860834,0.47901011,1,-0.82159454,0.44487721,0.63904921,1,1,-0.94980362,-0.70561283,-1,-1,0.55815786,-0.89480739,-0.059179869,-0.93594591,-0.84396517,0.071717322,0.072397178,-0.48822998,-0.78146643,0.36322628,0.16688277,-0.97445071,0.37568388,-0.41486237,-0.43321818,-1,-0.24381974,-0.71831386,0.17285819,0.34285623,-0.0054145698,0.075282416,-0.13023452,0.96933409,-0.6526493,-0.69064034,-0.96433842,-0.51664621,0.60252392,0.79860352,0.18342306,-0.031020236,-0.52116986,0.027560397,-0.036482204,0.99711084,0.95653746],[0.01282092,-1,0.042969381,-0.10657434,-0.875,-0.45581106,-0.69435234,-0.75,0.030349249,-0.36545654,-0.625,0.77976943,0.48725847,-0.5,0.83045547,1,-0.375,0.13221823,0.72616913,-0.25,-0.70007218,-0.11412809,-0.125,-1,-0.88295678,0,-0.53527186,-1,0.125,0.35573377,-0.3584197,0.25,1,0.55202887,0.375,0.8666098,0.93880561,0.5,0.0314704,0.36818438,0.625,-0.70493203,-0.53244391,0.75,-0.40309987,-0.21597136,0.875,0.50279047,0.01282092,1,0.042969381],[-0.27783236,0.41196225,-1,-0.0062396976,-0.90161104,-0.17410858,-0.99622636,-0.0084041703,0.30525388,0.28065908,-0.40171967,0.74346415,0.08501977,0.78684514,0.12843328,0.59193438,-0.53320875,0.44727453,-0.39077866,0.21930118,-0.050967724,1,-0.45879599,-0.050966037,0.4270266,0.76192807,-0.22279885,0.41952777,0.83592388,1,0.56521625,0.50447716,0.53000917,-0.62718442,-1,-0.081993738,-0.28470791,-0.16894155,0.56873184,-0.55074154,-0.79005019,-0.91857833,-0.41283658,1,0.64150903,0.41940723,-0.14398903,-0.43396654,-1,0.40931806,-0.25764411],[0.14903271,-0.30184235,-1,-0.11857359,-0.21180115,0.73096288,-1,0.19635323,0.00073742666,-0.84085014,-0.45123499,0.26719129,-0.33641198,-0.48425789,0.47998574,-0.28445277,-0.032601473,1,0.21215514,-0.043566152,0.46080141,0.65999859,-1,0.9056313,0.22212307,-0.96756794,-0.30141791,0.63591005,1,-0.48166325,1,0.57818845,0.33535103,0.86900523,0.22973529,0.6570513,0.53333436,0.4324913,-0.1959149,-0.37932987,-0.92383669,-0.1244286,-0.58690652,0.69363378,-0.5040904,0.17666183,-0.044180808,-0.11555366,0.48392935,-0.38774768,0.023549708],[1,-0.63413695,-0.52262769,-0.36960817,-0.42236112,0.64915257,-0.52553584,-0.36022038,-0.0025447182,0.20851854,0.81263667,0.30030741,-0.14444018,0.64399888,-0.14646213,-0.89762791,0.51582374,0.42554413,-0.21081412,0.042515317,-0.32383276,0.11353773,-0.5330078,-0.2803041,0.94453919,0.051949232,0.034475906,0.1680755,0.10628958,-1,-1,0.48112013,-0.1221671,0.30522738,0.4548596,1,-0.35170168,0.92817279,0.40934182,0.77947812,-1,0.417119,0.21793458,1,-0.56477316,0.20484305,-0.19036756,0.518262,0.86182395,0.64077022,0.10007944]],"xticklab":["-1.00","-0.60","-0.20","0.20","0.60","1.00"],"yticklab":["-1.00","-0.60","-0.20","0.20","0.60","1.00"],"zticklab":["1.00","0.60","0.20","-0.20","-0.60","-1.00"],"xtick":[0,0.2,0.4,0.6,0.8,1],"ytick":[0,0.2,0.4,0.6,0.8,1],"ztick":[0,0.2,0.4,0.6,0.8,1]},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>N &lt;- length(V(g2))  # number of vertices
graphjs(g2,
        layout=list(layout_randomly(g2, dim=3),
                    layout_on_sphere(g2),
                    layout_with_drl(g2, dim=3),
                    layout_with_fr(g2, dim=3)),
        vertex.color=list(rainbow(N),
                          &quot;blue&quot;,
                          &quot;orange&quot;,
                          rainbow(N)),
        vertex.label= V(g2)$name,
        vertex.size = log(V(g2)$vertex_degree),
        main=list(&quot;random layout&quot;, &quot;sphere layout&quot;,
                  &quot;drl layout&quot;, &quot;fr layout&quot;),
        fpl=300)</code></pre>
<div id="htmlwidget-2" style="width:672px;height:480px;" class="scatterplotThree html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"NROW":17,"height":null,"width":null,"axis":false,"numticks":[6,6,6],"xticklabs":null,"yticklabs":null,"zticklabs":null,"color":[["#FF0000","#FF5A00","#FFB400","#F0FF00","#96FF00","#3CFF00","#00FF1E","#00FF78","#00FFD2","#00D2FF","#0078FF","#001EFF","#3C00FF","#9600FF","#F000FF","#FF00B4","#FF005A"],"#0000FF","#FFA500",["#FF0000","#FF5A00","#FFB400","#F0FF00","#96FF00","#3CFF00","#00FF1E","#00FF78","#00FFD2","#00D2FF","#0078FF","#001EFF","#3C00FF","#9600FF","#F000FF","#FF00B4","#FF005A"]],"size":[2.56494935746154,2.63905732961526,2.63905732961526,2.89037175789616,2.77258872223978,2.56494935746154,3.04452243772342,2.83321334405622,2.94443897916644,2.30258509299405,2.484906649788,2.56494935746154,2.77258872223978,2.30258509299405,2.56494935746154,3.04452243772342,2.89037175789616],"stroke":"black","flipy":true,"grid":false,"renderer":"auto","signif":8,"bg":"white","cexsymbols":1,"xlim":[-1,1],"ylim":[-1,1],"zlim":[-1,1],"pch":["@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@"],"from":[[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,8,8,9,9,10,10,10,10,11,11,11,11,12,12,12,13,13,14,14,15]],"to":[[1,2,4,6,7,8,13,15,16,2,3,4,5,7,10,11,12,13,15,16,3,4,5,6,8,9,10,12,13,14,15,4,5,6,7,8,9,10,11,12,14,15,16,5,6,7,8,9,10,11,12,14,15,16,6,7,8,10,11,12,14,15,7,8,9,10,11,12,13,14,15,16,8,9,12,13,14,15,9,10,11,12,13,14,15,16,12,14,12,14,15,16,12,13,15,16,14,15,16,15,16,15,16,16]],"lwd":1,"linealpha":1,"center":true,"main":["random layout","sphere layout","drl layout","fr layout"],"fpl":300,"labels":["BARNEYS","COMME DES GARCONS HOMME","CONVERSE","DOCUMENT","DRIES VAN NOTEN","GRP","HELMUT LANG","HESCHUNG","ISSEY MIYAKE","LANVIN","MAISON MARTIN MARGIELA","NIKE","SAGE DE CRET","STEPHAN SCHNEIDER","UNDERCOVER","UNIQLO","VANS"],"options":true,"alpha":[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],1,1,[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],"vertices":[[0.015983928,0.12294206,0.24487308,0.29466097,0.7442502,-1,-0.46839017,-0.98241288,-0.69547347,-0.97239676,-0.051443072,0.51721834,-1,-0.57979921,0.44216224,-0.094889337,-0.13934896,-0.88483582,-0.93816468,-0.54051992,0.39140253,-0.94366801,-0.83301431,-0.23173435,0.81491881,-1,-0.056312444,-0.6788802,-0.71032917,0.82110384,1,-0.28229982,0.91242599,-0.17982562,0.13516249,-0.051740201,-0.71673831,-0.49178885,1,-0.53520572,1,0.84169567,0.29850029,0.37633315,0.5653948,0.21101006,-0.46184823,0.55526577,-0.98787089,0.98383458,-0.64280955],[0.01282092,-1,0.042969381,-0.10657434,-0.875,-0.45581106,-0.69435234,-0.75,0.030349249,-0.36545654,-0.625,0.77976943,0.48725847,-0.5,0.83045547,1,-0.375,0.13221823,0.72616913,-0.25,-0.70007218,-0.11412809,-0.125,-1,-0.88295678,0,-0.53527186,-1,0.125,0.35573377,-0.3584197,0.25,1,0.55202887,0.375,0.8666098,0.93880561,0.5,0.0314704,0.36818438,0.625,-0.70493203,-0.53244391,0.75,-0.40309987,-0.21597136,0.875,0.50279047,0.01282092,1,0.042969381],[-0.4813542,0.67879678,-0.71551946,0.24699504,0.67833758,0.43543793,0.82590513,1,-0.36994029,0.10185856,-0.016507682,0.46100739,0.32732143,0.32138615,-0.0553717,0.78319104,0.5334803,0.83034875,-0.44461882,0.43291073,-0.48913673,0.15526697,-0.021053803,-0.56191042,1,0.56459146,-1,-0.092722275,-0.95732968,0.30590784,0.98481365,-0.52409798,0.22214195,-0.24486452,0.20902425,0.2842678,-0.33533854,0.52896336,1,-1,0.16021376,-0.70943322,0.35560403,-1,0.028480198,0.39224039,0.30609219,-0.55009775,0.2100441,0.69317371,-0.21100379],[0.75235099,-0.29240569,0.90740126,0.59415128,0.86087627,-0.10409088,0.61516192,-0.49501218,-0.27137457,-0.013688515,0.090663114,-0.73896167,-0.40072075,0.0053789968,-0.12788043,-0.32304779,0.68762538,-0.65775462,0.061601041,-0.5321044,0.060470026,-0.75346724,0.078026509,0.42856747,-0.10293764,-0.20047088,0.34872566,-1,-1,-0.28654654,0.67291111,0.062274808,-1,-0.237664,1,0.24954105,-0.65291273,0.09871075,-0.61918357,0.63471763,0.44936248,1,-0.18486405,-0.64396304,-0.78207954,0.34545906,0.35016038,0.092219061,1,0.13820874,-0.086491603]],"xticklab":["-1.00","-0.60","-0.20","0.20","0.60","1.00"],"yticklab":["-1.00","-0.60","-0.20","0.20","0.60","1.00"],"zticklab":["1.00","0.60","0.20","-0.20","-0.60","-1.00"],"xtick":[0,0.2,0.4,0.6,0.8,1],"ytick":[0,0.2,0.4,0.6,0.8,1],"ztick":[0,0.2,0.4,0.6,0.8,1]},"evals":[],"jsHooks":[]}</script>
</section>
<section id="references" class="level3">
<h3>References</h3>
<p><a href="https://stackoverflow.com/questions/40181355/network-graph-using-r-node-size-based-on-number-of-connected-edges">vertex size</a></p>
<p><a href="https://stackoverflow.com/questions/36851569/import-of-vertices-attributes-in-igraph-in-r">setting vertex attributes</a></p>
<p><a href="http://paldhous.github.io/ucb/2016/dataviz/week14.html">gganimate tutorial</a></p>
</section>
