---
title: Interactive clothing networks
author: Allen Chang
date: '2018-01-30'
slug: interactive-clothing-networks
categories: []
tags:
  - networks
  - visualization
  - R
  - clothing
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<script src="/rmarkdown-libs/threejs/three.min.js"></script>
<script src="/rmarkdown-libs/threejs/Detector.js"></script>
<script src="/rmarkdown-libs/threejs/Projector.js"></script>
<script src="/rmarkdown-libs/threejs/CanvasRenderer.js"></script>
<script src="/rmarkdown-libs/threejs/TrackballControls.js"></script>
<script src="/rmarkdown-libs/threejs/StateOrbitControls.js"></script>
<script src="/rmarkdown-libs/scatterplotThree-binding/scatterplotThree.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>


<p>This is the 3rd part of my analysis on daily clothing choices (<a href="https://functionallydefined.netlify.com/posts/daily_wear/">part 1</a> and <a href="https://functionallydefined.netlify.com/posts/daily_clothing_network/">part 2</a>). In this post I’m going to be testing out the the <strong>threejs</strong> package and creating interactive networks using the <em>graphjs</em> function. I will also be using David Robinson’s <strong>gganimate</strong> package to create an animated timeline of my clothing choices.</p>
<p>As usual, here’s the packages used.</p>
<pre class="r"><code>library(tidyverse)
library(igraph)
library(threejs)
library(lubridate)
library(stringr)
library(reshape2)
library(htmlwidgets)
library(gganimate)</code></pre>
<section id="data-pre-processing" class="level3">
<h3>Data pre-processing</h3>
<p>Since my last post, I have continued to track my clothing choices everyday. All together, I have around 7 months of data, less a few weeks when I was on vacation and forgot to record (oops). Currently, the data are held in two csv files; one for summer and one for fall/winter.</p>
<p>I read in each csv file, then combined the datasets together. My fall/winter dataset contained records about the color of each article of clothing that my summer dataset did not so I had to select only the first 3 columns of fall/winter. These corresponded to date, article of clothing, and maker information. Since my last analysis, I’ve learned how to convert character strings into date using lubridate, so I changed my date column into month-day-year format.</p>
<pre class="r"><code>summer &lt;- read_csv(&quot;../../data/summer.csv&quot;)
fw &lt;- read_csv(&quot;../../data/fallwinter.csv&quot;)

fw &lt;- fw %&gt;%
  select(1:3)

clothes_df &lt;- bind_rows(summer, fw)
clothes_df$Day &lt;- mdy(clothes_df$Day)</code></pre>
<pre><code>## # A tibble: 6 x 3
##          Day Article                   Maker
##       &lt;date&gt;   &lt;chr&gt;                   &lt;chr&gt;
## 1 2017-06-06    Coat         Dries Van Noten
## 2 2017-06-06   Shirt         Dries Van Noten
## 3 2017-06-06   Pants Comme Des Garcons Homme
## 4 2017-06-06   Shoes                    Vans
## 5 2017-06-07    Coat                    &lt;NA&gt;
## 6 2017-06-07   Shirt                 Barneys</code></pre>
<p>Next I created a new column where I capitalized all text to amend capitalization typos and then cast my dataframe into a matrix.</p>
<pre class="r"><code>clothes_df &lt;- clothes_df %&gt;%
  mutate(maker_up = toupper(Maker)) %&gt;%
  select(Day, maker_up) %&gt;%
  filter(!maker_up == &quot;NA&quot;)

clothes_mat &lt;- clothes_df %&gt;%
  acast(maker_up ~ Day, fun.aggregate = length)

cooccur &lt;- clothes_mat %*% t(clothes_mat)</code></pre>
</section>
<section id="animated-timeline" class="level3">
<h3>Animated timeline</h3>
<p>To get the ordering of my maker’s, I ran a quick hierarchical clustering. This approach was borrowed from David Robinson’s post on networks in Love Actually (see a link in references for more information). After ordering the makers from most popular to least, I plotted my timeline. The gganimate package allowed me to create animations by adding <strong>frame</strong> to denote the dimension along which I wanted to animate. To keep the prior frames, I set the cumulative argument to TRUE. The result was a pretty cool animation showing my choices for each day.</p>
<pre class="r"><code>h &lt;- hclust(dist(clothes_mat, method = &quot;canberra&quot;))

ordering &lt;- h$labels[h$order]

day_vis &lt;- clothes_df %&gt;%
  ungroup() %&gt;%
  mutate(maker = factor(maker_up, levels = ordering)) 

p &lt;- ggplot(day_vis, aes(Day, maker)) +
  geom_path(aes(group = Day, frame = Day, cumulative = TRUE)) +
  geom_point(aes(frame = Day, cumulative = TRUE), color = &quot;red&quot;, size = 1) +
  geom_vline(aes(xintercept = as.numeric(Day), frame = as.numeric(Day)), lty = 2, color = &quot;black&quot;) +
  theme(axis.text.y = element_text(face=&quot;bold&quot;)) + 
  ylab(&quot;Maker&quot;) + xlab(&quot;Time&quot;) +
  ggtitle(&quot;7 months of clothing choices:&quot;) +
  scale_x_date(date_breaks = &quot;1 month&quot;, date_labels = &quot;%b&quot;) +
  theme_bw()

gganimate(p, &quot;test.gif&quot;, ani.width = 1000, ani.height = 500, interval = 0.3)</code></pre>
<p><img src="../../static/images/timeline.gif" /></p>
</section>
<section id="networks-in-igraph" class="level3">
<h3>Networks in igraph</h3>
<p>Next came the network component. I passed my adjacency matrix to the graph.adjacency function in igraph to create a network object. Then I made that into a sparse network by deleting vertices that had less than 10 counts.</p>
<pre class="r"><code>g &lt;- graph.adjacency(cooccur, weighted = TRUE, mode = &quot;undirected&quot;, diag = FALSE)

V(g)$vertex_degree &lt;-  degree(g)

counts &lt;- as.data.frame(lengths(as_adj_list(g))) %&gt;%
  rownames_to_column()

names(counts) &lt;- c(&quot;maker&quot;, &quot;count&quot;)
counts &lt;- counts %&gt;%
  filter(count &lt; 10)

g2 &lt;- delete_vertices(g, counts$maker)</code></pre>
</section>
<section id="interactive-networks-using-graphjs" class="level3">
<h3>Interactive networks using graphjs</h3>
<p>Finally it was time to make my interactive network. I wanted to color my vertices by the country of origin so I loaded each color into an object that I passed to the actual graphing function. To denote more frequently worn makers I scaled the vertex size by degree and labeled each vertex with the maker name. Lastly, there’s an option within the graphjs function that allowed me to animate different layouts. I liked the Fruchterman-Reingold layout the best, so I opted to have it be the final “resting” layout. Hovering over each vertex displays the maker and the edges are colored based on the vertex.</p>
<pre class="r"><code> scheme &lt;- c(&quot;#A60C00&quot;, &quot;#1533AD&quot;, &quot;#A60C00&quot;, &quot;#7109AA&quot;, &quot;#A63C00&quot;,
             &quot;#007B25&quot;, &quot;#009999&quot;, &quot;#CB0077&quot;, &quot;#1533AD&quot;, &quot;#CB0077&quot;,
             &quot;#CB0077&quot;, &quot;#A60C00&quot;, &quot;#1533AD&quot;, &quot;#A63C00&quot;, &quot;#1533AD&quot;,
             &quot;#1533AD&quot;, &quot;#A60C00&quot;)

graphjs(g2, 
        layout = list(
          layout_randomly(g2, dim = 3),
          layout_on_sphere(g2),
          layout_with_fr(g2, dim = 3, niter = 30),
          layout_with_drl(g2, dim = 3),
          layout_with_fr(g2, dim = 3, niter = 30)
        ),
        repulsion = 6, 
        vertex.shape = &quot;sphere&quot;,
        vertex.size = V(g2)$vertex_degree*.5,
        vertex.label= V(g2)$name,
        stroke = TRUE,
        curvature = 0.2,
        vertex.color = scheme,
        main = c(&quot;random layout&quot;,
                 &quot;sphere layout&quot;,
                 &quot;fr layout&quot;,
                 &quot;dr1 layout&quot;,
                 &quot;fr layout&quot;),
        fpl = 300)</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="scatterplotThree html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"NROW":17,"height":null,"width":null,"axis":false,"numticks":[6,6,6],"xticklabs":null,"yticklabs":null,"zticklabs":null,"color":[["#A60C00","#1533AD","#A60C00","#7109AA","#A63C00","#007B25","#009999","#CB0077","#1533AD","#CB0077","#CB0077","#A60C00","#1533AD","#A63C00","#1533AD","#1533AD","#A60C00"]],"size":[6.5,7,7,9,8,6.5,10.5,8.5,9.5,5,6,6.5,8,5,6.5,10.5,9],"stroke":true,"flipy":true,"grid":false,"renderer":"auto","signif":8,"bg":"white","cexsymbols":1,"xlim":[-1,1],"ylim":[-1,1],"zlim":[-1,1],"pch":["o","o","o","o","o","o","o","o","o","o","o","o","o","o","o","o","o"],"from":[[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,8,8,9,9,10,10,10,10,11,11,11,11,12,12,12,13,13,14,14,15]],"to":[[1,2,4,6,7,8,13,15,16,2,3,4,5,7,10,11,12,13,15,16,3,4,5,6,8,9,10,12,13,14,15,4,5,6,7,8,9,10,11,12,14,15,16,5,6,7,8,9,10,11,12,14,15,16,6,7,8,10,11,12,14,15,7,8,9,10,11,12,13,14,15,16,8,9,12,13,14,15,9,10,11,12,13,14,15,16,12,14,12,14,15,16,12,13,15,16,14,15,16,15,16,15,16,16]],"lwd":1,"linealpha":1,"center":true,"main":["random layout","sphere layout","fr layout","dr1 layout","fr layout"],"repulsion":6,"curvature":0.2,"fpl":300,"labels":["BARNEYS","COMME DES GARCONS HOMME","CONVERSE","DOCUMENT","DRIES VAN NOTEN","GRP","HELMUT LANG","HESCHUNG","ISSEY MIYAKE","LANVIN","MAISON MARTIN MARGIELA","NIKE","SAGE DE CRET","STEPHAN SCHNEIDER","UNDERCOVER","UNIQLO","VANS"],"options":true,"alpha":[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],"vertices":[[-0.55365344,0.87405484,0.73910387,0.54773191,-0.0019424195,0.70958264,-0.28497315,0.097220157,0.84661263,-0.22221102,-0.99415823,0.74125321,-0.58132023,1,-0.22445661,0.096612447,-0.0085947953,-0.21778919,0.53612961,0.47364464,-1,1,-0.64179061,0.28576868,-0.84543406,0.59802366,-0.27661495,-1,-0.63459075,0.95551654,0.096345307,0.36368054,0.83573193,-0.89397926,-1,0.99636346,0.76136699,0.14825169,1,0.52006199,0.82173374,-0.64367399,-0.44976798,0.17914645,0.093764281,0.38648965,-0.054580448,-0.62722309,-0.99214939,-0.49793381,0.29981768],[0.01282092,-1,0.042969381,-0.10657434,-0.875,-0.45581106,-0.69435234,-0.75,0.030349249,-0.36545654,-0.625,0.77976943,0.48725847,-0.5,0.83045547,1,-0.375,0.13221823,0.72616913,-0.25,-0.70007218,-0.11412809,-0.125,-1,-0.88295678,0,-0.53527186,-1,0.125,0.35573377,-0.3584197,0.25,1,0.55202887,0.375,0.8666098,0.93880561,0.5,0.0314704,0.36818438,0.625,-0.70493203,-0.53244391,0.75,-0.40309987,-0.21597136,0.875,0.50279047,0.01282092,1,0.042969381],[1,1,0.58586181,0.69952553,-0.4977451,-0.20448573,0.52010406,0.48597163,-0.65464913,-0.42387631,-0.40112289,-0.18206543,0.081515667,0.63264885,-0.31496505,-0.50320339,0.39209301,-0.81430471,-0.24432249,0.395927,0.37621197,0.10482229,0.92163896,0.1439246,-0.00057875534,-0.045195673,0.21452697,-1,0.4497464,-0.16919856,0.2130137,-1,-0.66103773,-0.32571754,-0.83019606,0.56142024,-0.16164016,-0.59035925,-0.4931317,0.67640189,0.14069749,1,-0.17620678,-0.28702837,-1,0.67516534,0.11320276,-0.02036885,0.45716418,-0.9935861,0.37003734],[-0.56248898,0.35751543,-0.12942955,-0.11831567,-1,-0.1340178,0.92969742,0.16644667,-0.15278986,0.48522585,-0.67469725,-0.16203004,0.14423631,-0.40017653,0.45975267,0.3278477,0.19861345,-0.96817485,0.20706147,0.11013325,-0.012264779,-0.22451249,-0.24054576,0.82241444,-0.53747351,-0.71247887,1,1,1,0.82003954,0.41695484,0.41513775,0.84651006,-0.11140904,-0.31810456,-1,-0.085482753,-0.83002156,-0.54162501,-1,-0.35584427,-0.31889821,0.407276,-0.26982836,0.94892987,0.11663109,-0.22136323,-0.4209713,-0.15100661,-0.015239607,0.22791321],[0.55864357,0.62802286,0.7128825,-0.70025588,0.39744266,0.70647623,1,0.26492171,-0.077454168,-0.7997784,-0.39909025,-0.29912645,-0.46861124,-0.54983421,0.0053045649,-0.066571143,-1,0.12430443,0.67012801,-0.54620176,0.33076269,0.44883423,-0.088964559,-0.41664785,0.62108571,-0.59864351,-0.10444735,0.49830905,-0.69998995,-1,0.17896613,1,0.095722401,-1,-0.93448905,0.75748642,-0.66221087,0.16943273,-0.28076196,0.74946937,0.021322679,1,0.21486952,0.5872457,-0.60129311,-0.57494294,0.48978912,0.18344887,-0.75290379,-0.035351437,0.56620683]],"xticklab":["-1.00","-0.60","-0.20","0.20","0.60","1.00"],"yticklab":["-1.00","-0.60","-0.20","0.20","0.60","1.00"],"zticklab":["1.00","0.60","0.20","-0.20","-0.60","-1.00"],"xtick":[0,0.2,0.4,0.6,0.8,1],"ytick":[0,0.2,0.4,0.6,0.8,1],"ztick":[0,0.2,0.4,0.6,0.8,1]},"evals":[],"jsHooks":[]}</script>
<p>I also used the original graphjs example included in the documentation because I liked the colors a lot better than my version. The only downside was though that these vertices did not have coloring relative to countries of origin and for some reason were harder to hover to get the maker information. Nevertheless, watching the colors change across layouts was a lot of fun!</p>
<pre class="r"><code>N &lt;- length(V(g2))  # number of vertices
graphjs(g2,
        layout=list(layout_randomly(g2, dim=3),
                    layout_on_sphere(g2),
                    layout_with_drl(g2, dim=3),
                    layout_with_fr(g2, dim=3)),
        vertex.color=list(rainbow(N),
                          &quot;blue&quot;,
                          &quot;orange&quot;,
                          rainbow(N)),
        vertex.label= V(g2)$name,
        vertex.size = log(V(g2)$vertex_degree),
        main=list(&quot;random layout&quot;, &quot;sphere layout&quot;,
                  &quot;drl layout&quot;, &quot;fr layout&quot;),
        fpl=300)</code></pre>
<div id="htmlwidget-2" style="width:672px;height:480px;" class="scatterplotThree html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"NROW":17,"height":null,"width":null,"axis":false,"numticks":[6,6,6],"xticklabs":null,"yticklabs":null,"zticklabs":null,"color":[["#FF0000","#FF5A00","#FFB400","#F0FF00","#96FF00","#3CFF00","#00FF1E","#00FF78","#00FFD2","#00D2FF","#0078FF","#001EFF","#3C00FF","#9600FF","#F000FF","#FF00B4","#FF005A"],"#0000FF","#FFA500",["#FF0000","#FF5A00","#FFB400","#F0FF00","#96FF00","#3CFF00","#00FF1E","#00FF78","#00FFD2","#00D2FF","#0078FF","#001EFF","#3C00FF","#9600FF","#F000FF","#FF00B4","#FF005A"]],"size":[2.56494935746154,2.63905732961526,2.63905732961526,2.89037175789616,2.77258872223978,2.56494935746154,3.04452243772342,2.83321334405622,2.94443897916644,2.30258509299405,2.484906649788,2.56494935746154,2.77258872223978,2.30258509299405,2.56494935746154,3.04452243772342,2.89037175789616],"stroke":"black","flipy":true,"grid":false,"renderer":"auto","signif":8,"bg":"white","cexsymbols":1,"xlim":[-1,1],"ylim":[-1,1],"zlim":[-1,1],"pch":["@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@"],"from":[[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,8,8,9,9,10,10,10,10,11,11,11,11,12,12,12,13,13,14,14,15]],"to":[[1,2,4,6,7,8,13,15,16,2,3,4,5,7,10,11,12,13,15,16,3,4,5,6,8,9,10,12,13,14,15,4,5,6,7,8,9,10,11,12,14,15,16,5,6,7,8,9,10,11,12,14,15,16,6,7,8,10,11,12,14,15,7,8,9,10,11,12,13,14,15,16,8,9,12,13,14,15,9,10,11,12,13,14,15,16,12,14,12,14,15,16,12,13,15,16,14,15,16,15,16,15,16,16]],"lwd":1,"linealpha":1,"center":true,"main":["random layout","sphere layout","drl layout","fr layout"],"fpl":300,"labels":["BARNEYS","COMME DES GARCONS HOMME","CONVERSE","DOCUMENT","DRIES VAN NOTEN","GRP","HELMUT LANG","HESCHUNG","ISSEY MIYAKE","LANVIN","MAISON MARTIN MARGIELA","NIKE","SAGE DE CRET","STEPHAN SCHNEIDER","UNDERCOVER","UNIQLO","VANS"],"options":true,"alpha":[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],1,1,[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],"vertices":[[-0.78610871,0.13335323,0.80076631,1,-0.80502526,0.26551329,0.28166683,-0.12882545,0.21075902,0.82565269,-0.74858498,0.82520805,-1,1,-0.86437651,-0.78321458,-1,-0.56277642,-0.52585352,-0.47564856,0.87538938,-0.071396589,0.97462364,0.32117566,0.20336301,0.38924427,0.90859445,0.46068875,0.55957361,-0.90091171,0.52453975,0.65575243,0.91056136,-0.60330882,0.33135854,0.62344485,0.83180742,0.41676675,-1,-0.82493729,0.36244078,1,0.47610786,-0.02489661,0.77891931,-0.73101829,-0.71635878,0.00099573709,-0.99809117,-0.61978827,-0.44358828],[0.01282092,-1,0.042969381,-0.10657434,-0.875,-0.45581106,-0.69435234,-0.75,0.030349249,-0.36545654,-0.625,0.77976943,0.48725847,-0.5,0.83045547,1,-0.375,0.13221823,0.72616913,-0.25,-0.70007218,-0.11412809,-0.125,-1,-0.88295678,0,-0.53527186,-1,0.125,0.35573377,-0.3584197,0.25,1,0.55202887,0.375,0.8666098,0.93880561,0.5,0.0314704,0.36818438,0.625,-0.70493203,-0.53244391,0.75,-0.40309987,-0.21597136,0.875,0.50279047,0.01282092,1,0.042969381],[1,-0.008056105,0.21813732,-0.0046685519,-0.43319371,0.61322522,-1,-0.16243724,0.29159074,-0.64846084,-0.11811966,-0.3451214,0.085415362,0.16230513,0.63617035,-0.52617278,-0.25145349,0.74174052,0.47380755,-0.22137287,0.18064682,-0.40942474,0.35198839,0.66171053,0.10483677,-0.27584866,-0.82959551,-0.26361054,1,-0.55834623,-0.27545435,-0.39890557,-0.34712654,0.17337091,-0.74087421,0.50165555,-0.29157697,-0.10291798,1,-0.22327673,-1,0.73573526,-0.36673975,0.17186866,-1,0.43849521,-0.53300188,0.024541539,0.48101601,0.15550232,-0.25720486],[0.35669617,1,0.83562768,1,-0.35106401,0.34159881,-0.19238255,-0.053566192,0.8125371,-0.023207028,-0.89816007,-0.19470801,0.061027716,-0.33103019,0.13287577,0.49843965,-0.89959913,-0.53383022,-0.25281172,0.30283264,0.11297806,0.12967259,0.31402073,-1,0.041407134,0.33977107,-0.30112697,-1,-0.087076122,-0.75139098,0.13587113,-1,0.837214,0.99580033,-0.075115741,-0.72467305,-0.01249743,-0.5125118,-0.78141332,0.87632264,0.97932549,0.12789736,-0.6187672,-0.60328213,0.098344249,0.58474006,0.056685465,0.12831217,0.50447773,-0.076386143,1]],"xticklab":["-1.00","-0.60","-0.20","0.20","0.60","1.00"],"yticklab":["-1.00","-0.60","-0.20","0.20","0.60","1.00"],"zticklab":["1.00","0.60","0.20","-0.20","-0.60","-1.00"],"xtick":[0,0.2,0.4,0.6,0.8,1],"ytick":[0,0.2,0.4,0.6,0.8,1],"ztick":[0,0.2,0.4,0.6,0.8,1]},"evals":[],"jsHooks":[]}</script>
</section>
<section id="conclusion" class="level3">
<h3>Conclusion</h3>
<p>That concludes my current set of analyses on clothing data. As I mentioned, I am still collecting data daily and plan to revisit my preferences after a full year has passed. I’ve enjoyed visualizing and using this data to explore different techniques and packages. Hopefully the results have been interesting for anyone reading this to see.</p>
</section>
<section id="references" class="level3">
<h3>References</h3>
<p><a href="https://www.rstudio.com/resources/videos/interactive-network-visualization-with-threejs-and-r/">bryan lewis rstudio talk on threejs</a></p>
<p><a href="http://varianceexplained.org/r/love-actually-network/">david robinson love actually network</a></p>
<p><a href="https://stackoverflow.com/questions/40181355/network-graph-using-r-node-size-based-on-number-of-connected-edges">help on setting vertex size</a></p>
<p><a href="https://stackoverflow.com/questions/36851569/import-of-vertices-attributes-in-igraph-in-r">setting vertex attributes</a></p>
<p><a href="http://paldhous.github.io/ucb/2016/dataviz/week14.html">gganimate tutorial</a></p>
</section>
