---
title: Interactive clothing networks
author: Allen Chang
date: '2018-01-30'
slug: interactive-clothing-networks
categories: []
tags:
  - networks
  - visualization
  - R
  - clothing
draft: yes
---

```{r echo=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
library(igraph)
library(threejs)
library(lubridate)
library(stringr)
library(reshape2)
library(htmlwidgets)
library(RColorBrewer)
```

```{r}
summer <- read_csv("/Users/allenchang/Desktop/functionally_defined/data/summer.csv")
fw <- read_csv("/Users/allenchang/Desktop/functionally_defined/data/fallwinter.csv")

fw <- fw %>%
  select(1:3)

clothes_df <- rbind(summer, fw)
clothes_df$Day <- mdy(clothes_df$Day)
```

```{r}
clothes_df <- clothes_df %>%
  mutate(maker_up = toupper(Maker)) %>%
  select(Day, maker_up) %>%
  filter(!maker_up == "NA")

clothes_mat <- clothes_df %>%
  acast(maker_up ~ Day, fun.aggregate = length)

cooccur <- clothes_mat %*% t(clothes_mat)

g <- graph.adjacency(cooccur, weighted = TRUE, mode = "undirected", diag = FALSE)
```

```{r}
V(g)$vertex_degree <-  degree(g)
```

```{r}
counts <- as.data.frame(lengths(as_adj_list(g))) %>%
  rownames_to_column()

names(counts) <- c("maker", "count")
counts <- counts %>%
  filter(count < 10)

g2 <- delete_vertices(g, counts$maker)
```


```{r}
country <- as.factor(c("USA", "United Kingdom", "Japan", "Japan", "USA", "USA", "South Korea", "Belgium", "Japan", "Italy", "Austria", "France", "Japan", "USA", "Germany", "Belgium", "France", "France", "France", "USA", "USA", "Sweden", "Canada", "Germany", "Japan", "Belgium", "Japan", "Japan", "USA"))

# V(g)$country <- country
set_vertex_attr(g, "country", index = V(g), as.factor(country))
palpair <- c("#47949B", "#1C366F", "#6E5AAF", "#4A1B6F", "#CE5D9B", "#F66F7C", "#A64A25",
             "#A62F00", "#FF7600", "#FFBC00", "#078600") 

countrycol <- c("#078600", "#FFBC00", "#A64A25", "#A64A25", "#078600", "#078600", "#A62F00", "#1C366F", "#A64A25","#F66F7C",
                "#47949B", "#4A1B6F", "#A64A25", "#078600", "#CE5D9B", "#1C366F", "#4A1B6F", "#4A1B6F", "#4A1B6F", "#078600", "#078600", "#FF7600", "#6E5AAF", "#CE5D9B", "#A64A25", "#1C366F", "#A64A25", "#A64A25", "#078600")

########## WIP
# country <- c("USA", "Japan", "USA", "South Korea", "Belgium",
#              "Italy", "Austria", "France", "Japan", "France",
#              "France" , "USA", "Japan", "Belgium", "Japan",
#              "Japan", "USA")

# V(g)$country <- country
# set_vertex_attr(g2, "country", index = V(g), as.factor(country))
# scheme <- c("#A60C00", "#1533AD", "#A60C00", "#7109AA", "#A63C00",
#             "#007B25", "#009999", "#CB0077", "#1533AD", "#CB0077",
#             "#CB0077", "#A60C00", "#1533AD", "#A63C00", "#1533AD",
#             "#1533AD", "#A60C00")


# V(g)$color <- as.factor(country)
```


```{r}
graphjs(g2, 
        repulsion = 6, 
        vertex.shape = "sphere",
        vertex.size = V(g)$vertex_degree*.5,
        vertex.label= V(g)$name,
        stroke = TRUE,
        curvature = 0.2,
        vertex.color = countrycol)
        # vertex.color = palpair)
        
```

### References

[vertex size](https://stackoverflow.com/questions/40181355/network-graph-using-r-node-size-based-on-number-of-connected-edges)

[setting vertex attributes](https://stackoverflow.com/questions/36851569/import-of-vertices-attributes-in-igraph-in-r)