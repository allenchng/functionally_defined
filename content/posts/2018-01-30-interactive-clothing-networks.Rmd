---
title: Interactive clothing networks
author: Allen Chang
date: '2018-01-30'
slug: interactive-clothing-networks
categories: []
tags:
  - networks
  - visualization
  - R
  - clothing
draft: yes
---

This is part 3 of my exploration of preferences in clothing choices ([part 1](), [part 2]()) In this post I'm going to be testing out the the **threejs** package and creating interactive networks using the *graphjs* function. I also 

```{r echo=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
library(igraph)
library(threejs)
library(lubridate)
library(stringr)
library(reshape2)
library(htmlwidgets)
library(gganimate)
```

### Data pre-processing

```{r message=FALSE, warning=FALSE}
summer <- read_csv("/Users/allenchang/Desktop/functionally_defined/data/summer.csv")
fw <- read_csv("/Users/allenchang/Desktop/functionally_defined/data/fallwinter.csv")

fw <- fw %>%
  select(1:3)

clothes_df <- rbind(summer, fw)
clothes_df$Day <- mdy(clothes_df$Day)
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
clothes_df <- clothes_df %>%
  mutate(maker_up = toupper(Maker)) %>%
  select(Day, maker_up) %>%
  filter(!maker_up == "NA")

clothes_mat <- clothes_df %>%
  acast(maker_up ~ Day, fun.aggregate = length)

cooccur <- clothes_mat %*% t(clothes_mat)


```

### Animated timeline 

```{r eval=FALSE, message=FALSE, warning=FALSE}

h <- hclust(dist(clothes_mat, method = "canberra"))

ordering <- h$labels[h$order]

day_vis <- clothes_df %>%
  ungroup() %>%
  mutate(maker = factor(maker_up, levels = ordering)) 

p <- ggplot(day_vis, aes(Day, maker)) +
  geom_path(aes(group = Day, frame = Day, cumulative = TRUE)) +
  geom_point(aes(frame = Day, cumulative = TRUE), color = "red", size = 1) +
  geom_vline(aes(xintercept = as.numeric(Day), frame = as.numeric(Day)), lty = 2, color = "black") +
  theme(axis.text.y = element_text(face="bold")) + 
  ylab("Maker") + xlab("Time") +
  ggtitle("7 months of clothing choices:") +
  scale_x_date(date_breaks = "1 month", date_labels = "%b") +
  theme_bw()

gganimate(p, "test.gif", ani.width = 1000, ani.height = 500, interval = 0.3)
```

![](/Users/allenchang/Desktop/timeline.gif)

### Networks in igraph

```{r echo=TRUE, message=FALSE, warning=FALSE}
g <- graph.adjacency(cooccur, weighted = TRUE, mode = "undirected", diag = FALSE)

V(g)$vertex_degree <-  degree(g)

counts <- as.data.frame(lengths(as_adj_list(g))) %>%
  rownames_to_column()

names(counts) <- c("maker", "count")
counts <- counts %>%
  filter(count < 10)

g2 <- delete_vertices(g, counts$maker)
```


```{r echo=TRUE, message=FALSE, warning=FALSE}
# country <- c("USA", "Japan", "USA", "South Korea", "Belgium",
#              "Italy", "Austria", "France", "Japan", "France",
#              "France" , "USA", "Japan", "Belgium", "Japan",
#              "Japan", "USA")

 scheme <- c("#A60C00", "#1533AD", "#A60C00", "#7109AA", "#A63C00",
             "#007B25", "#009999", "#CB0077", "#1533AD", "#CB0077",
             "#CB0077", "#A60C00", "#1533AD", "#A63C00", "#1533AD",
             "#1533AD", "#A60C00")

```

### Interactive networks using graphjs

```{r}
graphjs(g2, 
        layout = list(
          layout_randomly(g2, dim = 3),
          layout_on_sphere(g2),
          layout_with_fr(g2, dim = 3, niter = 30),
          layout_with_drl(g2, dim = 3),
          layout_with_fr(g2, dim = 3, niter = 30)
        ),
        repulsion = 6, 
        vertex.shape = "sphere",
        vertex.size = V(g2)$vertex_degree*.5,
        vertex.label= V(g2)$name,
        stroke = TRUE,
        curvature = 0.2,
        vertex.color = scheme,
        main = c("random layout",
                 "sphere layout",
                 "fr layout",
                 "dr1 layout",
                 "fr layout"),
        fpl = 300)
        
```

```{r}
N <- length(V(g2))  # number of vertices
graphjs(g2,
        layout=list(layout_randomly(g2, dim=3),
                    layout_on_sphere(g2),
                    layout_with_drl(g2, dim=3),
                    layout_with_fr(g2, dim=3)),
        vertex.color=list(rainbow(N),
                          "blue",
                          "orange",
                          rainbow(N)),
        vertex.label= V(g2)$name,
        vertex.size = log(V(g2)$vertex_degree),
        main=list("random layout", "sphere layout",
                  "drl layout", "fr layout"),
        fpl=300)
```




### References

[vertex size](https://stackoverflow.com/questions/40181355/network-graph-using-r-node-size-based-on-number-of-connected-edges)

[setting vertex attributes](https://stackoverflow.com/questions/36851569/import-of-vertices-attributes-in-igraph-in-r)

[gganimate tutorial](http://paldhous.github.io/ucb/2016/dataviz/week14.html)